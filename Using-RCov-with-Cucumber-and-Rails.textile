h2. How to use RCov with Cucumber and Rails


This page serves as an easy way to learn how to use cucumber and RCov together.

h3. Quick example

First, Aslak recommends that you use "spicycode's RCov":http://github.com/spicycode/rcov/tree/master instead of the 'official' one, as it currently segfaults too much for most people's taste.

<pre>
gem sources -a http://gems.github.com
gem uninstall rcov
gem install spicycode-rcov
</pre>

Second, you'll need to open up the cucumber generated task file and set the rcov config option.

<pre>
#lib/tasks/cucumber.rake
$:.unshift(RAILS_ROOT + '/vendor/plugins/cucumber/lib')
require 'cucumber/rake/task'
Cucumber::Rake::Task.new(:features) do |t|
  t.cucumber_opts = "--format pretty"
  t.rcov = true
end
task :features => 'db:test:prepare'
</pre>

Now when you run rake:features, coverage information will be in rails_root/coverage

h3. Other ways to run features

See "Running features":http://github.com/aslakhellesoy/cucumber/wikis/running-features


h3. Options

You usually want to define a task to run all your features without RCov and then have an additional task to run with RCov.  Also, you usually need to specify certain options to RCov, such as output directory, for cruise control and other build purposes.  Below is an example  cucumer.rake file showing how to set options and define multiple cucumber tasks:

<pre>
desc "Run all features"
task :features => "features:all"
task :features => 'db:test:prepare'
require 'cucumber/rake/task' #I have to add this -mischa

namespace :features do
  Cucumber::Rake::Task.new(:all) do |t|
    t.cucumber_opts = "--format pretty"
  end

  Cucumber::Rake::Task.new(:cruise) do |t|
    t.cucumber_opts = "--format pretty --out=#{ENV['CC_BUILD_ARTIFACTS']}/features.txt --format html --out=#{ENV['CC_BUILD_ARTIFACTS']}/features.html"
    t.rcov = true
    t.rcov_opts = %w{--rails --exclude osx\/objc,gems\/,spec\/}
    t.rcov_opts << %[-o "#{ENV['CC_BUILD_ARTIFACTS']}/features_rcov"]
  end

  Cucumber::Rake::Task.new(:rcov) do |t|    
    t.rcov = true
    t.rcov_opts = %w{--rails --exclude osx\/objc,gems\/,spec\/}
    t.rcov_opts << %[-o "features_rcov"]
  end
end
</pre>
(This was taken from "bmabey's cc.rb setup":http://gist.github.com/27281)

It is important to note that Cucumber's default RCov options are set to %w{--rails --exclude osx\/objc,gems\/}.  So you can just append to rcov_opts if those defaults work for your project.
